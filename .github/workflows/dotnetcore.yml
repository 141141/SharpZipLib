name: On Push

on: [push]

jobs:
  "Build and Test":
    runs-on: ${{ matrix.configuration }}
    strategy:
      matrix:
        configuration: ['Debug', 'Release']
        os: [ubuntu-latest, windows-latest]
        include:
          - os: windows-latest
            framework: net45
          - os: ubuntu-latest
            framework: netcoreapp2
    env:
      test-runner: test\ICSharpCode.SharpZipLib.TestBootstrapper\ICSharpCode.SharpZipLib.TestBootstrapper.csproj
      test-report: docs\nunit3-test-results-debug.xml
      framework: ${{ matrix.framework }}
      configuration: ${{ matrix.configuration }}
    steps:
    - uses: actions/checkout@v2
      
    - if: env.framework == 'netcoreapp2'
      name: Setup up .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 2.2.108
      
    - name: Build library
      run: dotnet build -c $configuration -f $framework src/ICSharpCode.SharpZipLib/ICSharpCode.SharpZipLib.csproj
      
    - name: Build tests
      run: dotnet build -c $configuration -f $framework test/ICSharpCode.SharpZipLib.Tests/ICSharpCode.SharpZipLib.Tests.csproj

    - name: Run tests
      run: dotnet run -c $configuration -f $framework -p $test-runner --result=$test-report

    - name: Upload nuget package artifact
      if: 'false'
      uses: actions/upload-artifact@v1
      with:
        name: Nuget package
        path: src/ICSharpCode.SharpZipLib/SharpZipLib.nupkg

    - name: Upload test report artifact
      uses: actions/upload-artifact@v1
      with:
        name: Test report
        path: $test-report
